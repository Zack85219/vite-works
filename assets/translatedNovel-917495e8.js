import{i as p,j as a}from"./index-263fe5d1.js";const{VITE_API_URL:s,VITE_API_PATH:i}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"59487@@",BASE_URL:"/vite-works/",MODE:"production",DEV:!1,PROD:!0},d=p("openBookAria",{state:()=>({books:[],productRecords:[],allBooks:[],tempBook:{},totalPages:1}),actions:{getBooks(){const e=`${s}/api/${i}/articles`;a.get(e).then(o=>{this.books=o.data.articles}).catch(o=>{console.log(o)})},getOrder(e){const o=`${s}/api/${i}/order/${e}`;a.get(o).then(t=>{this.productRecords={...t.data.order.products},this.userLogin()}).catch(t=>{console.log(t)})},getBookOpen(e){const o=`${s}/api/${i}/admin/article/${e}`;a.get(o).then(t=>{if(t.data.article.isPublic)return!1;this.tempBook=t.data.article,this.tempBook.isPublic=!0,this.updateBook(e)}).catch(t=>{console.log(t)})},updateBook(e){const o=`${s}/api/${i}/admin/article/${e}`;a.put(o,{data:this.tempBook}).then(t=>{console.log(t.data),this.allBooks=[],document.cookie=`hexToken=;expires=${new Date}`,console.log("update cookie: "+document.cookie)}).catch(t=>{console.log(t)})},userLogin(){const e="https://vue3-course-api.hexschool.io/v2/admin/signin",o={username:"j33241796@gmail.com",password:"Jj741236p"};a.post(e,o).then(t=>{const{token:l,expired:c}=t.data;a.defaults.headers.common.Authorization=l,document.cookie=`hexToken=${l};expires=${new Date(c)}; path=/`,console.log("document.cookie: "+document.cookie),this.getArticalPage()}).catch(t=>{console.log(t)})},getAllArtical(){let e="",o="";for(let t=1;t<=this.totalPages;t++){let l=`${s}/api/${i}/admin/articles?page=${t}`;a.get(l).then(c=>{if(c.data.articles.forEach(r=>{this.allBooks.push({[r.title]:r.id})}),t>=this.totalPages)for(let r in this.productRecords)e=this.productRecords[r].product.title,this.allBooks.map(n=>{Object.keys(n)[0]===e&&(o=n[e],this.getBookOpen(o))})}).catch(c=>{console.log(c)})}},getArticalPage(){const e=`${s}/api/${i}/admin/articles`;a.get(e).then(o=>{this.totalPages=o.data.pagination.total_pages,console.log("total pages: "+this.totalPages),this.getAllArtical()}).catch(o=>{console.log(o)})}},getters:{}});export{d as b};
