import{_ as P,a as w,r as v,o as u,c as m,d as n,b as t,F as C,j as A,k as f,t as _,w as L,e as x,l as y,v as I,n as V,p as S,g as U}from"./index-f93256b3.js";import{c as T}from"./cart-108539c2.js";const{VITE_API_URL:c,VITE_API_PATH:i}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"59487@@",BASE_URL:"/Vue3-works/",MODE:"production",DEV:!1,PROD:!0},q={data(){return{loadingStatus:{loadingItem:""},products:[],product:{},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1}},methods:{getProducts(){const a=`${c}/api/${i}/products`;this.$http.get(a).then(e=>{this.products=e.data.products,this.isLoading=!1}).catch(e=>{alert(e.res.data.message)})},getProduct(a){const e=`${c}/api/${i}/product/${a}`;this.$http.get(e).then(o=>{this.product=o.data.product,this.$refs.userProductModal.openModal()}).catch(o=>{alert(o.res.data.message)})},addToCart(a,e=1){const o=`${c}/api/${i}/cart`,p={product_id:a,qty:e};this.$refs.userProductModal.hideModal(),this.$http.post(o,{data:p}).then(s=>{alert(s.data.message),this.getCart(),this.getCartInfo()}).catch(s=>{alert(s.res.data.message)})},updateCart(a){this.loadingStatus.loadingItem=a.id;const e=`${c}/api/${i}/cart/${a.id}`,o={product_id:a.product_id,qty:a.qty};this.$http.put(e,{data:o}).then(p=>{alert(p.data.message),this.getCart()}).catch(p=>{alert(p.response.data.message)})},deleteAllCarts(){const a=`${c}/api/${i}/carts`;this.$http.delete(a).then(e=>{alert(e.data.message),this.getCart(),this.getCartInfo()}).catch(e=>{alert(e.response.data.message)})},getCart(){const a=`${c}/api/${i}/cart`;this.$http.get(a).then(e=>{this.cart=e.data.data}).catch(e=>{alert(e.res.data.message)})},removeCartItem(a){const e=`${c}/api/${i}/cart/${a}`;this.$http.delete(e).then(o=>{alert(o.data.message),this.getCart(),this.getCartInfo()}).catch(o=>{alert(o.res.data.message)})},createOrder(){const a=`${c}/api/${i}/order`,e=this.form;this.$http.post(a,{data:e}).then(o=>{alert(o.data.message),this.$refs.form.resetForm(),this.form.message="",this.getCart(),this.getCartInfo()}).catch(o=>{alert(o.response.data.message)})},...w(T,["getCartInfo"])},mounted(){this.isLoading=!0,this.getProducts(),this.getCart()}},d=a=>(S("data-v-4ad7ab93"),a=a(),U(),a),M={class:"container border border-primary border-2 my-5"},$={class:"table align-middle"},F=d(()=>t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",{class:"text-end"},"單價")])],-1)),B=["onClick"],D=d(()=>t("i",{class:"bi bi-trash"},null,-1)),N=[D],O={key:0,class:"text-success"},R={class:"input-group input-group-sm"},j={class:"input-group mb-3"},z=["onUpdate:modelValue","onBlur"],H={class:"input-group-text",id:"basic-addon2"},G={class:"text-end"},J={key:0,class:"text-success"},K={key:0},Q={colspan:"3",class:"text-end"},W={class:"text-end"},X={key:0},Y=d(()=>t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1)),Z={class:"text-end text-success"},tt={class:"text-end"},et={class:"d-flex justify-content-center"},st={class:"my-5 row justify-content-center"},at={class:"mb-3"},ot=d(()=>t("label",{for:"email",class:"form-label"},"Email",-1)),lt={class:"mb-3"},rt=d(()=>t("label",{for:"name",class:"form-label"},"收件人姓名",-1)),nt={class:"mb-3"},dt=d(()=>t("label",{for:"tel",class:"form-label"},"收件人電話",-1)),ct={class:"mb-3"},it=d(()=>t("label",{for:"address",class:"form-label"},"收件人地址",-1)),ut={class:"mb-3"},mt=d(()=>t("label",{for:"message",class:"form-label"},"留言",-1)),_t=d(()=>t("div",{class:"text-end"},[t("button",{class:"btn btn-outline-danger"},"送出訂單")],-1));function pt(a,e,o,p,s,h){const k=v("VueLoading"),g=v("VueField"),b=v("ErrorMessage"),E=v("VueForm");return u(),m(C,null,[n(k,{active:s.isLoading,"z-index":1060},null,8,["active"]),t("div",M,[t("table",$,[F,t("tbody",null,[s.cart.carts?(u(!0),m(C,{key:0},A(s.cart.carts,l=>(u(),m("tr",{key:l.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>h.removeCartItem(l.id)},N,8,B)]),t("td",null,[x(_(l.product.title)+" ",1),l.coupon?(u(),m("div",O,"已套用優惠券")):f("",!0)]),t("td",null,[t("div",R,[t("div",j,[y(t("input",{"onUpdate:modelValue":r=>l.qty=r,onBlur:r=>h.updateCart(l),min:"1",type:"number",class:"form-control",disabled:""},null,40,z),[[I,l.qty,void 0,{number:!0}]]),t("span",H,_(l.product.unit),1)])])]),t("td",G,[s.cart.final_total!==s.cart.total?(u(),m("small",J,"折扣價：")):f("",!0),x(" "+_(l.final_total),1)])]))),128)):f("",!0)]),s.cart.carts?(u(),m("tfoot",K,[t("tr",null,[t("td",Q,_(s.cart.total===0?"":"總計"),1),t("td",W,_(s.cart.total===0?"":s.cart.total),1)]),s.cart.final_total!==s.cart.total?(u(),m("tr",X,[Y,t("td",Z,_(s.cart.final_total),1)])):f("",!0)])):f("",!0)]),t("div",tt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=(...l)=>h.deleteAllCarts&&h.deleteAllCarts(...l))}," 清空購物車 ")]),t("div",et,_(s.cart.total===0?"目前沒有商品":""),1),t("div",st,[n(E,{ref:"form",class:"col-md-6",onSubmit:h.createOrder},{default:L(({errors:l})=>[t("div",at,[ot,n(g,{id:"email",name:"email",type:"email",class:V(["form-control",{"is-invalid":l.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.form.user.email,"onUpdate:modelValue":e[1]||(e[1]=r=>s.form.user.email=r)},null,8,["class","modelValue"]),n(b,{name:"email",class:"invalid-feedback"})]),t("div",lt,[rt,n(g,{id:"name",name:"姓名",type:"text",class:V(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.form.user.name,"onUpdate:modelValue":e[2]||(e[2]=r=>s.form.user.name=r)},null,8,["class","modelValue"]),n(b,{name:"姓名",class:"invalid-feedback"})]),t("div",nt,[dt,n(g,{id:"tel",name:"電話",type:"tel",class:V(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:s.form.user.tel,"onUpdate:modelValue":e[3]||(e[3]=r=>s.form.user.tel=r)},null,8,["class","modelValue"]),n(b,{name:"電話",class:"invalid-feedback"})]),t("div",ct,[it,n(g,{id:"address",name:"地址",type:"text",class:V(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.form.user.address,"onUpdate:modelValue":e[4]||(e[4]=r=>s.form.user.address=r)},null,8,["class","modelValue"]),n(b,{name:"地址",class:"invalid-feedback"})]),t("div",ut,[mt,y(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[5]||(e[5]=r=>s.form.message=r)},null,512),[[I,s.form.message]])]),_t]),_:1},8,["onSubmit"])])])],64)}const gt=P(q,[["render",pt],["__scopeId","data-v-4ad7ab93"]]);export{gt as default};
