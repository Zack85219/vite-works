import{P as M}from"./PaginationView-dc5f0d8c.js";import{m as U,D as x}from"./DelModal-5c661777.js";import{_ as v,o as n,c as d,b as t,l as P,F as b,k as y,H as m,I as u,K as D,r as p,d as _,t as g}from"./index-56446f1c.js";const I={data(){return{newImage:"",modal:"",localP:{}}},props:["isNew","tempProduct","delImage"],methods:{createImage(){console.log("img"),this.$emit("emit-create-img",this.newImage),this.newImage=""},update(){this.$emit("emit-update-parent",this.localP.id,this.localP)}},watch:{tempProduct(){this.localP={...this.tempProduct}}},mixins:[U]},V={id:"productModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},C={class:"modal-dialog modal-xl"},L={class:"modal-content border-0"},E={class:"modal-header bg-dark text-white"},N={id:"productModalLabel",class:"modal-title"},$={key:0},B={key:1},S=t("button",{type:"button",class:"btn-close bg-light","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),A={class:"modal-body"},z={class:"row"},F={class:"col-sm-4"},T={class:"mb-2"},H={class:"mb-3"},K=t("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),j=["value"],q=["src","alt"],G={class:"mb-3"},J=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1),O=["value"],Q=["src"],R=["onClick"],W={class:"col-sm-8"},X={class:"mb-3"},Y=t("label",{for:"title",class:"form-label"},"標題",-1),Z={class:"row"},tt={class:"mb-3 col-md-6"},et=t("label",{for:"category",class:"form-label"},"分類",-1),st={class:"mb-3 col-md-6"},ot=t("label",{for:"price",class:"form-label"},"單位",-1),lt={class:"row"},it={class:"mb-3 col-md-6"},at=t("label",{for:"origin_price",class:"form-label"},"原價",-1),nt={class:"mb-3 col-md-6"},dt=t("label",{for:"price",class:"form-label"},"售價",-1),ct=t("hr",null,null,-1),rt={class:"mb-3"},mt=t("label",{for:"description",class:"form-label"},"產品描述",-1),ut={class:"mb-3"},ht=t("label",{for:"content",class:"form-label"},"說明內容",-1),pt={class:"mb-3"},_t={class:"form-check"},gt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),bt={class:"modal-footer"},ft=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Pt(i,e,l,r,s,a){return n(),d("div",V,[t("div",null,[t("div",C,[t("div",L,[t("div",E,[t("h5",N,[l.isNew?(n(),d("span",$,"新增產品")):(n(),d("span",B,"編輯產品"))]),S]),t("div",A,[t("div",z,[t("div",F,[t("div",T,[t("div",H,[K,t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結",value:l.tempProduct.imageUrl},null,8,j)]),t("img",{class:"img-fluid",src:l.tempProduct.imageUrl,alt:l.tempProduct.id},null,8,q),l.tempProduct.imagesUrl?P("",!0):(n(),d("button",{key:0,class:"btn btn-outline-danger btn-sm d-block w-100 mt-2",onClick:e[0]||(e[0]=(...o)=>l.delImage&&l.delImage(...o))}," 刪除圖片 "))]),(n(!0),d(b,null,y(l.tempProduct.imagesUrl,(o,h)=>(n(),d("div",{class:"mb-2",key:h},[t("div",G,[J,t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結",value:o},null,8,O)]),t("img",{class:"img-fluid",src:l.tempProduct.imagesUrl[h],alt:"image"},null,8,Q),t("div",null,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100 mt-2",onClick:f=>l.delImage(h)}," 刪除圖片 ",8,R)])]))),128)),m(t("input",{type:"text",class:"form-control mt-4",placeholder:"請輸入圖片連結，輸入後才會出現新增的按鈕","onUpdate:modelValue":e[1]||(e[1]=o=>s.newImage=o)},null,512),[[u,s.newImage]]),t("div",null,[s.newImage?(n(),d("button",{key:0,class:"btn btn-outline-primary btn-sm d-block w-100 mt-2",type:"button",onClick:e[2]||(e[2]=(...o)=>a.createImage&&a.createImage(...o))}," 新增圖片 ")):P("",!0)])]),t("div",W,[t("div",X,[Y,m(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[3]||(e[3]=o=>s.localP.title=o)},null,512),[[u,s.localP.title]])]),t("div",Z,[t("div",tt,[et,m(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[4]||(e[4]=o=>s.localP.category=o)},null,512),[[u,s.localP.category]])]),t("div",st,[ot,m(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[5]||(e[5]=o=>s.localP.unit=o)},null,512),[[u,s.localP.unit]])])]),t("div",lt,[t("div",it,[at,m(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[6]||(e[6]=o=>s.localP.origin_price=o)},null,512),[[u,s.localP.origin_price,void 0,{number:!0}]])]),t("div",nt,[dt,m(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[7]||(e[7]=o=>s.localP.price=o)},null,512),[[u,s.localP.price,void 0,{number:!0}]])])]),ct,t("div",rt,[mt,m(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[8]||(e[8]=o=>s.localP.description=o)},`
                  `,512),[[u,s.localP.description]])]),t("div",ut,[ht,m(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[9]||(e[9]=o=>s.localP.content=o)},`
                  `,512),[[u,s.localP.content]])]),t("div",pt,[t("div",_t,[m(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=o=>s.localP.is_enabled=o)},null,512),[[D,s.localP.is_enabled]]),gt])])])])]),t("div",bt,[ft,t("button",{type:"button",class:"btn btn-primary",onClick:e[11]||(e[11]=(...o)=>a.update&&a.update(...o))}," 確認 ")])])])])],512)}const vt=v(I,[["render",Pt]]);const yt={data(){return{apiEP:"https://vue3-course-api.hexschool.io/v2",apiPath:"59487@@",isNew:!1,products:[],tempProduct:{imagesUrl:[]},isLoading:!1,page:{}}},components:{PaginationView:M,DelModal:x,ProductModal:vt},methods:{checkAdmin(){const i=`${this.apiEP}/api/user/check`;this.$http.post(i).then(e=>{this.getData(),console.log(e)}).catch(e=>{console.log(e.data)})},getData(i=1){const e=`${this.apiEP}/api/${this.apiPath}/admin/products?page=${i}`;this.isLoading=!0,this.$http.get(e).then(l=>{this.isLoading=!1,this.products=l.data.products,this.page=l.data.pagination}).catch(l=>{this.isLoading=!1,console.log(l.data),this.$httpMessageState(l.response,"錯誤訊息")})},showEditModal(i){this.isNew=!1,this.tempProduct={...i},this.$refs.productModal.openModal()},showBlankModal(){this.isNew=!0,this.tempProduct={},this.$refs.productModal.openModal()},showDelModal(i){this.tempProduct={...i},this.$refs.delModal.openModal()},updateData(i,e){let l="",r="",s="建立";this.isNew||(l=`${this.apiEP}/api/${this.apiPath}/admin/product/${i}`,r="put",s="更新"),this.isNew&&(l=`${this.apiEP}/api/${this.apiPath}/admin/product`,r="post"),this.isLoading=!0,this.$http[r](l,{data:e}).then(a=>{this.isLoading=!1,this.getData(),this.$httpMessageState(a,s),this.$refs.productModal.hideModal()}).catch(a=>{this.isLoading=!1,this.$httpMessageState(a.response,"錯誤訊息")})},deleteData(i,e){const l=`${this.apiEP}/api/${this.apiPath}/admin/product/${i}`;this.isLoading=!0,this.$http.delete(l,{data:e}).then(r=>{this.isLoading=!1,this.getData(),this.$httpMessageState(r,"刪除產品"),this.$refs.delModal.hideModal()}).catch(r=>{this.isLoading=!1,this.$httpMessageState(r.response,"錯誤訊息")})},createImage(i){this.tempProduct.imageUrl?!this.tempProduct.imagesUrl&&this.tempProduct.imageUrl?(this.tempProduct.imagesUrl=[],this.tempProduct.imagesUrl.push(i)):this.tempProduct.imagesUrl&&this.tempProduct.imageUrl&&this.tempProduct.imagesUrl.push(i):this.tempProduct.imageUrl=i},delImage(i){this.tempProduct.imagesUrl?this.tempProduct.imagesUrl.splice(i,1):this.tempProduct.imageUrl=null,alert("已刪除圖片")}},mounted(){const i=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=i,this.getData()}},wt={class:"text-end mt-4"},kt={class:"table mt-4"},Mt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Ut={class:"text-end"},xt={class:"text-end"},Dt={key:0,class:"text-success"},It={key:1},Vt={class:"btn-group"},Ct=["onClick"],Lt=["onClick"];function Et(i,e,l,r,s,a){const o=p("VueLoading"),h=p("ProductModal"),f=p("DelModal"),w=p("PaginationView");return n(),d(b,null,[_(o,{active:s.isLoading,"z-index":1060},null,8,["active"]),t("div",null,[t("div",wt,[t("button",{class:"btn btn-dark",type:"button",onClick:e[0]||(e[0]=(...c)=>a.showBlankModal&&a.showBlankModal(...c))}," 建立新的產品 ")]),t("table",kt,[Mt,t("tbody",null,[(n(!0),d(b,null,y(s.products,c=>(n(),d("tr",{key:c.id},[t("td",null,g(c.category),1),t("td",null,g(c.title),1),t("td",Ut,g(c.origin_price),1),t("td",xt,g(c.price),1),t("td",null,[c.is_enabled?(n(),d("span",Dt,"啟用")):(n(),d("span",It,"未啟用"))]),t("td",null,[t("div",Vt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:k=>a.showEditModal(c)}," 編輯 ",8,Ct),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:k=>a.showDelModal(c)}," 刪除 ",8,Lt)])])]))),128))])])]),_(h,{"is-new":s.isNew,"temp-product":s.tempProduct,onEmitCreateImg:a.createImage,onEmitUpdateParent:a.updateData,"del-image":a.delImage,ref:"productModal"},null,8,["is-new","temp-product","onEmitCreateImg","onEmitUpdateParent","del-image"]),_(f,{"temp-product":s.tempProduct,onEmitDelParent:a.deleteData,ref:"delModal"},null,8,["temp-product","onEmitDelParent"]),_(w,{pages:s.page,"get-product":a.getData},null,8,["pages","get-product"])],64)}const St=v(yt,[["render",Et]]);export{St as default};
