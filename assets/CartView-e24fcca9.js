import{_ as E,a as y,r as v,o as d,c,d as n,b as t,F as x,k as w,l as p,t as u,w as A,e as C,H as I,I as k,n as V,p as P,h as M}from"./index-d04a7f04.js";import{c as U}from"./cart-f2a11094.js";import{b as $}from"./translatedNovel-5585b648.js";const{VITE_API_URL:m,VITE_API_PATH:_}={VITE_API_URL:"https://vue3-course-api.hexschool.io/v2",VITE_API_PATH:"59487@@",BASE_URL:"/vite-works/",MODE:"production",DEV:!1,PROD:!0},q={data(){return{loadingStatus:{loadingItem:""},products:[],product:{},form:{user:{name:"",email:"",tel:"",address:""},message:""},cart:{},isLoading:!1}},methods:{getProducts(){this.isLoading=!0;const o=`${m}/api/${_}/products`;this.$http.get(o).then(e=>{this.products=e.data.products,this.isLoading=!1}).catch(e=>{alert(e.res.data.message),this.isLoading=!1})},getProduct(o){const e=`${m}/api/${_}/product/${o}`;this.$http.get(e).then(a=>{this.product=a.data.product,this.$refs.userProductModal.openModal()}).catch(a=>{alert(a.res.data.message)})},updateCart(o){this.loadingStatus.loadingItem=o.id;const e=`${m}/api/${_}/cart/${o.id}`,a={product_id:o.product_id,qty:o.qty};this.$http.put(e,{data:a}).then(f=>{this.getCart(),this.$httpMessageState(f,"更新購物車")}).catch(f=>{alert(f.response.data.message)})},deleteAllCarts(){const o=`${m}/api/${_}/carts`;this.$http.delete(o).then(e=>{this.$httpMessageState(e,"刪除購物車全部項目"),this.getCart(),this.getCartInfo()}).catch(e=>{alert(e.response.data.message)})},getCart(){const o=`${m}/api/${_}/cart`;this.$http.get(o).then(e=>{this.cart=e.data.data}).catch(e=>{alert(e.res.data.message)})},removeCartItem(o){const e=`${m}/api/${_}/cart/${o}`;this.$http.delete(e).then(a=>{this.$httpMessageState(a,"刪除購物車項目"),this.getCart(),this.getCartInfo()}).catch(a=>{alert(a.res.data.message)})},createOrder(){this.isLoading=!0;const o=`${m}/api/${_}/order`,e=this.form;this.$http.post(o,{data:e}).then(a=>{this.$httpMessageState(a,"贊助"),console.log(a.data),this.getOrder(a.data.orderId),this.$refs.form.resetForm(),this.form.message="",this.getCart(),this.getCartInfo(),this.isLoading=!1,this.$router.push("/checkouts")}).catch(a=>{alert(a),this.isLoading=!1})},...y(U,["getCartInfo"]),...y($,["getOrder"])},mounted(){this.getProducts(),this.getCart()}},i=o=>(P("data-v-34ba7b90"),o=o(),M(),o),T={class:"container border border-primary border-2 my-5"},B={class:"table align-middle"},F=i(()=>t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",{class:"text-end"},"單價")])],-1)),O=["onClick"],D=i(()=>t("i",{class:"bi bi-trash"},null,-1)),N=[D],R={key:0,class:"text-success"},H={class:"input-group input-group-sm"},j={class:"input-group mb-3"},z=["onUpdate:modelValue","onBlur"],G={class:"input-group-text",id:"basic-addon2"},J={class:"text-end"},K={key:0,class:"text-success"},Q={key:0},W={colspan:"3",class:"text-end"},X={class:"text-end"},Y={key:0},Z=i(()=>t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1)),tt={class:"text-end text-success"},et={class:"text-end"},st={class:"d-flex justify-content-center"},ot={class:"my-5 row justify-content-center"},at={class:"mb-3"},lt=i(()=>t("label",{for:"email",class:"form-label"},"Email",-1)),rt={class:"mb-3"},nt=i(()=>t("label",{for:"name",class:"form-label"},"收件人姓名",-1)),it={class:"mb-3"},dt=i(()=>t("label",{for:"tel",class:"form-label"},"收件人電話",-1)),ct={class:"mb-3"},ut=i(()=>t("label",{for:"address",class:"form-label"},"收件人地址",-1)),mt={class:"mb-3"},_t=i(()=>t("label",{for:"message",class:"form-label"},"留言",-1)),ht=i(()=>t("div",{class:"text-end"},[t("button",{class:"btn btn-outline-primary connectBtn"},"贊助確認")],-1));function pt(o,e,a,f,s,h){const S=v("VueLoading"),g=v("VueField"),b=v("ErrorMessage"),L=v("VueForm");return d(),c(x,null,[n(S,{active:s.isLoading,"z-index":1060},null,8,["active"]),t("div",T,[t("table",B,[F,t("tbody",null,[s.cart.carts?(d(!0),c(x,{key:0},w(s.cart.carts,l=>(d(),c("tr",{key:l.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:r=>h.removeCartItem(l.id)},N,8,O)]),t("td",null,[C(u(l.product.title)+" ",1),l.coupon?(d(),c("div",R,"已套用優惠券")):p("",!0)]),t("td",null,[t("div",H,[t("div",j,[I(t("input",{"onUpdate:modelValue":r=>l.qty=r,onBlur:r=>h.updateCart(l),min:"1",type:"number",class:"form-control",disabled:""},null,40,z),[[k,l.qty,void 0,{number:!0}]]),t("span",G,u(l.product.unit),1)])])]),t("td",J,[s.cart.final_total!==s.cart.total?(d(),c("small",K,"折扣價：")):p("",!0),C(" "+u(l.final_total),1)])]))),128)):p("",!0)]),s.cart.carts?(d(),c("tfoot",Q,[t("tr",null,[t("td",W,u(s.cart.total===0?"":"總計"),1),t("td",X,u(s.cart.total===0?"":s.cart.total),1)]),s.cart.final_total!==s.cart.total?(d(),c("tr",Y,[Z,t("td",tt,u(s.cart.final_total),1)])):p("",!0)])):p("",!0)]),t("div",et,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:e[0]||(e[0]=(...l)=>h.deleteAllCarts&&h.deleteAllCarts(...l))}," 清空購物車 ")]),t("div",st,u(s.cart.total===0?"目前沒有商品":""),1),t("div",ot,[n(L,{ref:"form",class:"col-md-6",onSubmit:h.createOrder},{default:A(({errors:l})=>[t("div",at,[lt,n(g,{id:"email",name:"email",type:"email",class:V(["form-control",{"is-invalid":l.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.form.user.email,"onUpdate:modelValue":e[1]||(e[1]=r=>s.form.user.email=r)},null,8,["class","modelValue"]),n(b,{name:"email",class:"invalid-feedback"})]),t("div",rt,[nt,n(g,{id:"name",name:"姓名",type:"text",class:V(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.form.user.name,"onUpdate:modelValue":e[2]||(e[2]=r=>s.form.user.name=r)},null,8,["class","modelValue"]),n(b,{name:"姓名",class:"invalid-feedback"})]),t("div",it,[dt,n(g,{id:"tel",name:"電話",type:"tel",class:V(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:s.form.user.tel,"onUpdate:modelValue":e[3]||(e[3]=r=>s.form.user.tel=r)},null,8,["class","modelValue"]),n(b,{name:"電話",class:"invalid-feedback"})]),t("div",ct,[ut,n(g,{id:"address",name:"地址",type:"text",class:V(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.form.user.address,"onUpdate:modelValue":e[4]||(e[4]=r=>s.form.user.address=r)},null,8,["class","modelValue"]),n(b,{name:"地址",class:"invalid-feedback"})]),t("div",mt,[_t,I(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[5]||(e[5]=r=>s.form.message=r)},null,512),[[k,s.form.message]])]),ht]),_:1},8,["onSubmit"])])])],64)}const vt=E(q,[["render",pt],["__scopeId","data-v-34ba7b90"]]);export{vt as default};
